@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model MachinePortal.Models.Device

@* Check User Permissions *@
@using Microsoft.AspNetCore.Identity
@using MachinePortal.Areas.Identity.Data
@using Microsoft.EntityFrameworkCore
@inject UserManager<MachinePortalUser> UserManager
@inject IdentityContext identityContext
@{
    var user = await UserManager.GetUserAsync(User);
    List<string> permissions = new List<string>();
    if (user != null) { permissions = ((from obj in identityContext.UserPermission select obj).Include(p => p.Permission).Where(x => x.UserID == user.Id).ToList()).Select(p => p.Permission.PermissionName).ToList(); };
    if (!permissions.Contains("PageDevices")) { Context.Response.Redirect("/Home/AccessDenied"); };
}

<div class="card fb-card c-vitesco-green-03">
    <div class="card-header c-vitesco-green-03">
        <i style="vertical-align:middle" class="ti-harddrives c-vitesco-green-03"></i>
        <div class="d-inline-block">
            <h2 style="color:white">@Model.Name</h2>
        </div>
        <hr style="border:1px solid white" />
        <div class="d-inline-block">
            <h2 style="color:white">@Localizer["General Data"].Value</h2>
        </div>
    </div>
    <div class="card-block card-padding">
        <dl class="dl-horizontal">
            <dd>
                @if (Model.ImagePath != null)
                {
                    <img src="@Html.DisplayFor(model => model.ImagePath)" height="300" class="img-thumbnail" />
                }
                else
                {
                    <img src="~/resources/General/NoImage.jpg" height="300" class="img-thumbnail" />
                }
            </dd>
            <br />
            <dt>
                @Html.DisplayNameFor(model => model.Name)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Name)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.Brand)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Brand)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.Model)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Model)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.PartNumber)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.PartNumber)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.Description)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Description)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.Price)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Price)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.Supplier)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.Supplier)
            </dd>
            <dt>
                @Html.DisplayNameFor(model => model.StockLocation)
            </dt>
            <dd>
                @Html.DisplayFor(model => model.StockLocation)
            </dd>
        </dl>
    </div>
</div>

<div class="card fb-card c-vitesco-green-03">
    <div class="card-header c-vitesco-green-03">
        <div class="d-inline-block">
            <h2 style="color:white">@Localizer["Documents"].Value</h2>
        </div>
    </div>
    <div class="card-block card-padding">
        <dl class="dl-horizontal">
            <div class="table-responsive">
                <table class="table table-hover table-bordered table-vitesco" id="tImages">
                    <thead>
                        <tr class="thead-vitesco">
                            <th>
                                @Localizer["ID"].Value
                            </th>
                            <th>
                                @Localizer["Name"].Value
                            </th>
                            <th class="text-center">
                                Download
                            </th>
                            <th class="text-center">
                                Open
                            </th>
                        </tr>
                    </thead>
                    @foreach (DeviceDocument document in Model.Documents)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => document.ID)</td>
                            <td>@Html.DisplayFor(modelItem => document.Name)</td>
                            <td class="text-center ws-nowrap">@Html.ActionLink("Download", "Download", new { filePath = document.Path, fileName = document.Name, extension = document.Extension }, new { @class = "btn btn-primary" })</td>
                            <td class="text-center ws-nowrap"><a class="btn btn-success" href="@document.Path@document.Name" target="_blank">Open</a></td>
                        </tr>
                    }
                </table>
            </div>
        </dl>
    </div>
</div>

<input type="hidden" asp-for="ID" />
<button style="width:120px; font-weight:700;" class="btn btn-primary" action="action" onclick="history.go(-1);">@Localizer["Back"].Value</button>
@if (permissions.Contains("DevicesEdit"))
{
    <button style="width:120px; font-weight:700; float:right;" class="btn btn-primary" asp-action="Edit" asp-route-id="@Model.ID">@Localizer["Edit"].Value</button>
}